name: Test Dry run

on:
  workflow_dispatch:
    inputs:
      target_repo:
        description: 'GitHub repository to test against (e.g., openalea/repo)'
        default: 'openalea/astk'
        required: true
      target_ref:
        description: 'Git ref to checkout (branch, tag, or SHA)'
        default: 'master'
        required: false

jobs:
  test-actions:
    runs-on: ubuntu-latest
    steps:
      # allow refering to action being developped in a branch (relative reference in uses below)
      - name: Checkout action repository
        uses: actions/checkout@v4
      - name: Checkout target repository
        uses: actions/checkout@v4
        with:
          repository: ${{ inputs.target_repo }}
          ref: ${{ inputs.target_ref }}
          token: ${{ secrets.GITHUB_TOKEN }}
          path: target_repo
      - name: Run promote (dry run mode)
        uses: ./promote
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          dry_run: 'true'
          root-dir: target_repo