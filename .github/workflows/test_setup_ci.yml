name: Test Composite Action setup-ci

on:
  workflow_dispatch:
    inputs:
      simulated-ref:
        description: "Ref to simulate (e.g., refs/heads/main, refs/tags/v1.0.0)"
        required: false
        default: "refs/heads/feature/test"
      simulated-event:
        description: "Event to simulate (e.g., push, pull_request)"
        required: false
        default: "push"
        
jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - ref: "refs/heads/feature"
            event: "push"
          - ref: "refs/heads/feature"
            event: "pull_request"
          - ref: "refs/heads/main"
            event: "push"
          - ref: "refs/tags/v1.0.0"
            event: "push"
          - event: "release"
    env:
      GITHUB_REF: ${{ github.ref }}
      GITHUB_EVENT_NAME: ${{ github.event }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Run setup-ci for different scenarios
        id: setci
        uses: openalea/action-build-publish-anaconda/setup-ci@setup_action
        with:
          simulated-ref: ${{ matrix.ref }}
          simulated-event: ${{ matrix.event }}
      - name: Print output
        run: |
          echo "simulated ref: ${{ matrix.ref }}"
          echo "GITHUB_EVENT_NAME: ${{ matrix.event }}"
          echo "is_branch:  ${{ steps.setci.outputs.is_branch }}"
          echo "is_master:  ${{ steps.setci.outputs.is_master }}"
          echo "is_pr:      ${{ steps.setci.outputs.is_pr }}"
          echo "is_tag:     ${{ steps.setci.outputs.is_tag }}"
          echo "is_release: ${{ steps.setci.outputs.is_release }}"
          echo "os:         ${{ steps.setci.outputs.os }}"
          echo "py:         ${{ steps.setci.outputs.py }}"