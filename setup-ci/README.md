# setup-ci

This action:
1. Check if 'meta.yaml' exists and allows external version setting
2. Detect calling context and set contextual flags (is_master, is_branch, is_release...)
3. Set OS Ã— Python matrix array depending on event
4. Set publication variables depending on event (publish, promote...)
5. Set conda channels in priority order depending on event (dev, rc, main)
6. Detect package version based on context and git v* tags (1.1.0, 1.1.1.dev)

The only mandatory input is the anaconda token to access your anaconda repository.

## Example

```yaml
# your_github_workflow.yml
name: MyWorkflow
...
    steps:
    ...
    - name: Setup-CI
      uses: openalea/action-build-publish-anaconda/setup-ci@main
      with:
          git-ref: github.ref
          git-event: github.event_name
```

## Action inputs
The following inputs are available for this action:
| Name | Description | Required | Default value |
|------|-------------|----------|---------------|
|`conda-directory`| Directory with conda recipe (i.e. `meta.yml` file)| No | `conda`|
|`python-minor-version`| List of python minor versions to build/deploy | No | `[9, 10, 11, 12]` |
|`operating-system`| List of OS for build | No | `'["ubuntu-latest", "macos-latest", "macos-13", "windows-latest"]'` (fixed by python version)|
|`token` | Anaconda access Token (cf. use process described [above](#anaconda_token))| Yes | |
|`anaconda-channel`| Channel hosting development labels to publish on | No | `https://conda.anaconda.org/openalea3` |
|`labels` | A comma-separated string of channel labels for dev, release candidates and release | No |`dev,rc,main` |
|`git-ref` | github.ref context of calling workflow | No | ` ` |
|`git-event` | github.event_name context of calling workflow | No | ` ` |

## Action outputs
The following outputs are generated by this action:
| Name | Description |
|------|-------------|
|`build_os`| Selected OS to build on |
|`build_py`| Selected Python minor versions to build on |
|`publish`| True if publication is required | 
|`promote` | True if promotion is required |
|`channels`| A comma separated string of channels to pick-up packages during builds |
|`publish_on` | label to publish on |
|`promote_from` | label to promote from |
|`promote_to` | label to promote to |
|`version` | computed package version |

